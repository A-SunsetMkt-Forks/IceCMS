import{E as B}from"./CQdKq0Vt.js";import{E as N,a as T}from"./Bo10sX-3.js";import{a as F,E as L}from"./BJwtCnNB.js";import{E as D}from"./C8LkNO85.js";import{E as R,a as M}from"./GprZAYzg.js";import{E as $}from"./g0zu4MNc.js";import{E as j}from"./CJRYR2W1.js";import{v as G}from"./U29o3j68.js";import{u as y}from"./CJdOkxoU.js";import"./C7dLEZkI.js";import"./BpqunBSk.js";import{E as c}from"./B1mjav-x.js";import{E as h}from"./CtkJBwaH.js";import{g as J,C as P}from"./3Yncbi-l.js";import{d as q,r as _,k as z,c as E,o as g,v as A,u as r,m as H,g as l,b as t,a as K,e as p,_ as O}from"./C_uFub58.js";import"./BM-sVEEH.js";import"./dXWXmwas.js";import"./BtvKXLLF.js";import"./BUADUvnR.js";import"./CxYcxH0g.js";import"./CXVv3ulD.js";const Q={class:"home"},W={class:"homeContent"},X={class:"postInfo-container"},Y={key:1,class:"login-prompt"},Z=q({__name:"index",setup(ee){const m=_(!1),u=_(!1),f=_({name:"",profile:"",intro:"",userid:""}),o=_({userid:"",username:"",name:"",profile:"",email:"",intro:"",gender:"",phone:"",height:"",birthday:"",academic:"",monthly:"",permanent:"",userage:0,createTime:"",lastLogin:"",integral:0,resource:""}),b=async()=>{u.value=!0;try{const a=await J();if(a&&a.code===200){const e=a.data;console.log(e);let s="";e.gender===0?s="女":e.gender===1&&(s="男"),o.value={userid:e.userid||"",username:e.username||"",name:e.name||"",profile:e.profile||"",email:e.email||"",intro:e.intro||"",gender:e.gender!==void 0?e.gender:"",phone:e.phone||"",height:e.height||"",birthday:e.birthday||"",academic:e.academic||"",monthly:e.monthly||"",permanent:e.permanent||"",userage:e.userage||0,createTime:e.createTime||"",lastLogin:e.lastLogin||"",integral:e.integral||0,resource:s},y().updateUserInfo({userid:e.userid,name:e.name,username:e.username,profile:e.profile,intro:e.intro,email:e.email}),m.value=!0}else console.error("获取用户信息失败:",a),c.error("获取用户信息失败"),m.value=!1}catch(a){console.error("获取用户信息出错:",a),c.error("获取用户信息出错"),m.value=!1}finally{u.value=!1}};async function x(){if(!o.value.userid){c.error("用户信息无效，请重新登录");return}try{u.value=!0;let a;o.value.resource==="女"?a=0:o.value.resource==="男"?a=1:a=o.value.gender;const e={userId:o.value.userid,name:o.value.name,email:o.value.email,intro:o.value.intro,gender:a,phone:o.value.phone,height:o.value.height,birthday:o.value.birthday,academic:o.value.academic,monthly:o.value.monthly,permanent:o.value.permanent},s=await P(e);s&&s.code===200?(h({title:"成功",message:"用户信息修改成功",type:"success",offset:50}),y().updateUserInfo({name:o.value.name,email:o.value.email,intro:o.value.intro,gender:a.toString()}),o.value.gender=a):h({title:"失败",message:"修改失败",type:"warning",offset:50})}catch(a){console.error("修改用户信息出错:",a),h({title:"失败",message:"修改失败，请检查网络连接",type:"error",offset:50})}finally{u.value=!1}}return z(async()=>{const a=y();a.userid?(f.value.name=a.name,f.value.profile=a.profile,f.value.intro=a.intro,f.value.userid=a.userid,console.log("用户已登录:",a.name),await b()):(console.log("用户未登录"),m.value=!1,c.warning("请先登录"))}),(a,e)=>{const s=B,i=N,d=L,V=F,U=D,w=M,k=R,v=$,I=T,C=j,S=G;return g(),E("div",Q,[A((g(),E("div",W,[r(m)?(g(),H(I,{key:0,ref:"userInfoForm",model:r(o),"label-width":"80px"},{default:l(()=>[t(V,null,{default:l(()=>[t(d,{span:24},{default:l(()=>[K("div",X,[t(V,null,{default:l(()=>[t(d,{span:8},{default:l(()=>[t(i,{label:"昵称："},{default:l(()=>[t(s,{style:{width:"220px"},modelValue:r(o).name,"onUpdate:modelValue":e[0]||(e[0]=n=>r(o).name=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:8},{default:l(()=>[t(i,{label:"邮箱："},{default:l(()=>[t(s,{style:{width:"180px"},modelValue:r(o).email,"onUpdate:modelValue":e[1]||(e[1]=n=>r(o).email=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:6},{default:l(()=>[t(i,{label:"积分："},{default:l(()=>[t(s,{disabled:!0,style:{width:"220px"},modelValue:r(o).integral,"onUpdate:modelValue":e[2]||(e[2]=n=>r(o).integral=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(i,{label:"出生日期"},{default:l(()=>[t(d,{span:11},{default:l(()=>[t(U,{type:"date",placeholder:"选择日期",modelValue:r(o).birthday,"onUpdate:modelValue":e[3]||(e[3]=n=>r(o).birthday=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{label:"性别"},{default:l(()=>[t(k,{modelValue:r(o).resource,"onUpdate:modelValue":e[4]||(e[4]=n=>r(o).resource=n)},{default:l(()=>[t(w,{label:"男"},{default:l(()=>e[7]||(e[7]=[p("男")])),_:1}),t(w,{label:"女"},{default:l(()=>e[8]||(e[8]=[p("女")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"个人简介"},{default:l(()=>[t(s,{type:"textarea",modelValue:r(o).intro,"onUpdate:modelValue":e[5]||(e[5]=n=>r(o).intro=n)},null,8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(v,{type:"primary",onClick:x,loading:r(u)},{default:l(()=>e[9]||(e[9]=[p("更新")])),_:1},8,["loading"]),t(v,{onClick:b},{default:l(()=>e[10]||(e[10]=[p("重置")])),_:1})]),_:1})]),_:1},8,["model"])):(g(),E("div",Y,[t(C,{description:"请先登录"},{default:l(()=>[t(v,{type:"primary",onClick:e[6]||(e[6]=n=>a.$router.push("/login"))},{default:l(()=>e[11]||(e[11]=[p("前往登录")])),_:1})]),_:1})]))])),[[S,r(u)]])])}}}),Ve=O(Z,[["__scopeId","data-v-e9458166"]]);export{Ve as default};
