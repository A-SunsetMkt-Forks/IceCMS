import{_ as j,E as G,a as L}from"./CWE-KJV6.js";import{d as T,r,B as R,C as q,k as w,D as z,E as M,c as S,o as h,a as e,b as l,n as V,v as J,t as b,m as K,F as P,f as W,g as Y,p as C,e as H,G as X,K as $,_ as O}from"./C_uFub58.js";import{_ as Q}from"./CiUdNee2.js";import{_ as Z}from"./CpW1LMPF.js";import{v as ee}from"./U29o3j68.js";import"./g0zu4MNc.js";import{E as c}from"./B1mjav-x.js";import{E as U}from"./CtkJBwaH.js";import{h as te}from"./DFZ1BoYC.js";import{g as oe,C as ae}from"./3Yncbi-l.js";import{u as v}from"./CJdOkxoU.js";import"./CQdKq0Vt.js";import"./BM-sVEEH.js";import"./Bo10sX-3.js";import"./dXWXmwas.js";import"./yw5b7RCA.js";import"./CXVv3ulD.js";import"./BUADUvnR.js";import"./CRxF1tn9.js";import"./BpqunBSk.js";const se=y=>te.post("/ImageApi/updateimage",y,{headers:{"Content-Type":"multipart/form-data"},timeout:6e4}),ne={class:"home"},ie={id:"__nuxt"},re={id:"__layout"},le={"data-fetch-key":"0",class:"app macwk-animation"},ce={style:{"margin-bottom":"100px"},class:"layout-index pc-model mt-5"},ue={id:"content",class:"site-content"},de={id:"author",class:"author wrapper"},pe={class:"box b2-radius author-header"},me={class:"user-cover-button"},fe={id:"cover-input",type:"file",class:"b2-hidden-always",ref:"fileInput",accept:"image/jpg,image/jpeg,image/png,image/gif"},_e={class:"user-panel"},ge={class:"avatar"},he={class:"user-panel-info"},be={class:""},ve={style:{display:"flex"}},ye={id:"userDisplayName",class:"usertopName"},ke={class:"author-table mg-t"},Ie={class:"author-page-right"},xe={class:"author-page-right-in box b2-radius"},we=["onClick"],Se=T({__name:"UserInfo",setup(y){const p=r(!1),u=r(!1),n=r({userid:"",name:"",username:"",profile:"",intro:"",email:"",phone:"",gender:"",height:"",birthday:"",academic:"",monthly:"",permanent:"",userage:0,createTime:"",lastLogin:"",integral:0});R({userId:"",profile:""});const k=q();w(()=>{k.options.scrollBehavior=(o,t,a)=>a||!1}),z(()=>k.currentRoute.value,()=>{requestAnimationFrame(()=>{window.scrollTo({top:window.scrollY,behavior:"smooth"})})}),r(localStorage.getItem("activeItem")||"Gai");const m=r("Gai"),A=M(),B=()=>{m.value=I.find(o=>o.link===A.path)?.key||"Gai",localStorage.setItem("activeItem",m.value)},I=[{key:"Gai",label:"概览",link:"/userInfo",icon:"b2font b2-user-heart-line b2-light b2-color"},{key:"Fa",label:"作品查看",link:"/userInfo/post",icon:"b2font b2-quill-pen-line b2-light b2-color"},{key:"Hui",label:"关注列表",link:"/userInfo/follow",icon:"b2font b2-hand-heart-line b2-light b2-color"},{key:"Ding",label:"订单",link:"/userInfo/payInfo",icon:"b2font b2-file-list-2-line b2-light b2-color"},{key:"Yuan",label:"会员中心",link:"/userInfo/vip",icon:"b2font b2-hands-heart-line b2-light b2-color"},{key:"Chong",label:"充值中心",link:"/userInfo/charge",icon:"b2font b2-heart-add-line b2-light b2-color"},{key:"Xiu",label:"修改密码",link:"/userInfo/changePw",icon:"b2font b2-hearts-line b2-light b2-color"},{key:"Si",label:"私信",link:"/userInfo/chat/1",icon:"b2font b2-hearts-line b2-light b2-color"},{key:"Shou",label:"发布作品",link:"/userInfo/star",icon:"b2font b2-star-line b2-light b2-color"}],D=o=>{m.value=o},E=r("https://img.tukuppt.com/bg_grid/00/14/86/WvJAithG7a.jpg!/fh/350"),N=async()=>{u.value=!0;try{const o=await oe();if(o&&o.code===200){const t=o.data;n.value={userid:t.userid||"",name:t.name||"",username:t.username||"",profile:t.profile||"",intro:t.intro||"",email:t.email||"",phone:t.phone||"",gender:t.gender||"",height:t.height||"",birthday:t.birthday||"",academic:t.academic||"",monthly:t.monthly||"",permanent:t.permanent||"",userage:t.userage||0,createTime:t.createTime||"",lastLogin:t.lastLogin||"",integral:t.integral||0},v().updateUserInfo({userid:t.userid,name:t.name,username:t.username,profile:t.profile,intro:t.intro,email:t.email}),p.value=!0}else console.error("获取用户信息失败:",o),c.error("获取用户信息失败"),p.value=!1}catch(o){console.error("获取用户信息出错:",o),c.error("获取用户信息出错"),p.value=!1}finally{u.value=!1}},F=async o=>{const a=o.target.files?.[0];if(!a)return;if(!a.type.startsWith("image/")){c.error("请选择图片文件");return}if(a.size>2*1024*1024){c.error("图片大小不能超过2MB");return}const f=new FormData;f.append("editormd-image-file",a);try{u.value=!0;const s=await se(f);if(s&&s.data&&s.data.url){const d=s.data.url;n.value.profile=d;const g={userId:n.value.userid,profile:d},_=await ae(g);_&&_.code===200?(U({title:"成功",message:"头像修改成功",type:"success",offset:50}),v().updateUserInfo({profile:d})):U({title:"失败",message:"头像修改失败",type:"warning",offset:50})}else c.error("上传失败，服务器响应异常")}catch(s){console.error("上传失败:",s),c.error("上传失败，请检查网络或图片大小")}finally{u.value=!1}};return w(async()=>{B(),v().userid?await N():(console.log("用户未登录"),p.value=!1)}),(o,t)=>{const a=j,f=G,s=L,d=X,g=Q,_=Z,x=ee;return h(),S("div",ne,[e("div",ie,[e("div",re,[e("div",le,[l(a),e("div",null,[e("section",ce,[e("div",ue,[e("div",de,[e("div",pe,[e("div",{class:"mask-wrapper",style:V({backgroundImage:"url("+E.value+")"})},[e("div",null,[e("div",me,[t[0]||(t[0]=e("label",{class:"empty button",for:"cover-input"},[e("i",{class:"b2font b2-image-fill"}),e("span",null,"上传封面图片")],-1)),e("input",fe,null,512)])])],4),e("div",_e,[e("div",ge,[J(l(f,{shape:"square",size:150,src:n.value.profile},null,8,["src"]),[[x,u.value]]),t[1]||(t[1]=e("label",{class:"editor-avatar",for:"avatar-input"},[e("i",{class:"b2font b2-image-fill"}),e("span",null,"修改我的头像")],-1)),e("input",{id:"avatar-input",type:"file",class:"b2-hidden-always",accept:"image/jpg,image/jpeg,image/png,image/gif",onChange:F},null,32)]),e("div",he,[e("div",be,[e("h1",ve,[e("span",ye,b(n.value.name||n.value.username||"新用户"),1)]),e("p",null,b(n.value.intro||"这个人很懒，什么都没有留下！"),1)]),t[2]||(t[2]=e("div",{class:"user-panel-editor-button"},[e("div",{class:"user-follow"})],-1))])])]),e("div",ke,[e("div",Ie,[e("div",xe,[(h(),S(P,null,W(I,i=>e("div",{key:i.key,onClick:Ce=>D(i.key)},[l(s,{to:i.link},{default:Y(()=>[e("div",{class:C(["user-sidebar-info",{active:m.value===i.key}])},[e("p",null,[e("i",{class:C(i.icon)},null,2),H(" "+b(i.label),1)]),t[3]||(t[3]=e("div",{class:"author-sidebar-down"},[e("i",{class:"b2font b2-arrow-right-s-line"})],-1))],2)]),_:2},1032,["to"])],8,we)),64))])]),(h(),K($,null,[l(d)],1024))])])])]),l(g)]),l(_),t[4]||(t[4]=e("div",{infos:"0"},[e("div",{class:"adBanner pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links"})],-1))])])])])}}}),Ye=O(Se,[["__scopeId","data-v-4a86a246"]]);export{Ye as default};
